<!DOCTYPE html>
<html lang="zh-CN" class="transition-colors duration-300">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> 
    <meta name="apple-mobile-web-app-title" content="Future Flow">
    
    <meta id="theme-color" name="theme-color" content="#2563eb">

    <link rel="apple-touch-icon" href="icon/ico.png">

    <title>Future Flow Pro</title>
    
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script>
        // ç«‹å³æ‰§è¡Œï¼šåœ¨é¡µé¢æ¸²æŸ“å‰åˆ¤æ–­ä¸»é¢˜ï¼Œé˜²æ­¢ç™½å±é—ªçƒ
        try {
            // âœ… ä¿®æ”¹ key åï¼Œå¼ºåˆ¶é‡ç½®ä¸ºè·Ÿéšç³»ç»Ÿ
            const savedTheme = localStorage.getItem('future_flow_theme');
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        } catch (e) {}
    </script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.min.js"></script>
    
   <style>
        [v-cloak] { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .mask-image-fade {
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }
        /* å¢åŠ é¢œè‰²è¿‡æ¸¡ï¼Œè®©åˆ‡æ¢æ›´ä¸æ»‘ */
        * { transition-property: background-color, border-color, color, fill, stroke; transition-duration: 200ms; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .quadrant-grid { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; height: 100%; gap: 1px; background: #e5e7eb; }
        html.dark .quadrant-grid { background: #374151; }
        
        .q-cell { background: white; padding: 8px; overflow-y: auto; display: flex; flex-direction: column; }
        html.dark .q-cell { background: #1f2937; } 

        .progress-bar { transition: width 0.5s ease-in-out; }

        .ios-switch { position: relative; display: inline-block; width: 50px; height: 30px; }
        .ios-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e5e7eb; transition: .4s; border-radius: 34px; }
        html.dark .slider { background-color: #4b5563; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: #2563eb; }
        input:checked + .slider:before { transform: translateX(20px); }

        /* --- ä¿®æ”¹å¼€å§‹ --- */
        html, body {
            /* 1. ç§»é™¤ position: fixedï¼Œé¿å…ä¸ dvh å†²çª */
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; 
            /* 2. å°†èƒŒæ™¯è‰²è®¾ä¸ºä¸å¤œé—´æ¨¡å¼ä¸€è‡´çš„æ·±è‰²ï¼Œé˜²æ­¢åŠ è½½æ—¶åº•éƒ¨é—ªç™½æ¡ */
            background-color: #111827; 
            overscroll-behavior: none; 
            -webkit-overflow-scrolling: touch;
            /* ğŸš€ æ–°å¢ï¼šå¼ºåˆ¶ç¦ç”¨æµè§ˆå™¨çš„é»˜è®¤åŒå‡»æ‰‹åŠ¿ */
            touch-action: manipulation; 
            
            /* ğŸš€ æ–°å¢ï¼šé˜²æ­¢ iOS è‡ªåŠ¨è°ƒæ•´å­—ä½“å¤§å°å¯¼è‡´çš„å¸ƒå±€é”™ä½ */
            -webkit-text-size-adjust: 100%;
        }

        #app {
            /* 3. å¼ºåˆ¶ç»å¯¹å®šä½ï¼Œå æ»¡å±å¹• */
            position: absolute; 
            top: 0;
            left: 0;
            width: 100vw;
            
            /* 4. å…³é”®ï¼šä½¿ç”¨ 100dvh (Dynamic Viewport Height) */
            /* è¿™ä¼šè‡ªåŠ¨é€‚åº” iOS åº•éƒ¨å·¥å…·æ çš„å±•å¼€/æ”¶èµ·ï¼Œç¡®åˆ‡å¡«æ»¡å±å¹• */
            height: 100dvh; 
            
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            background-color: white; /* æ¢å¤å†…å®¹èƒŒæ™¯è‰² */
        }

        html.dark #app {
            background-color: #111827;
        }
        
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }

        /* âœ… æ–°å¢: ä¸“é—¨å¤„ç†åº•éƒ¨å®‰å…¨åŒºçš„ç±» */
        .pb-safe {
            /* åº•éƒ¨ä¿ç•™å®‰å…¨åŒº + 4px çš„åŸºç¡€é—´è·ï¼Œé˜²æ­¢è´´åº• */
            padding-bottom: calc(env(safe-area-inset-bottom) + 4px) !important;
        }

        /* --- ä¿®å¤ iOS PWA è¾“å…¥æ¡†æ— æ³•èšç„¦çš„é—®é¢˜ --- */
        
        /* 1. å…¨å±€ç¦æ­¢é•¿æŒ‰èœå•å’Œé€‰æ‹©ï¼Œæ¨¡æ‹ŸåŸç”Ÿ App è´¨æ„Ÿ */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            /* âœ… æ–°å¢ï¼šç¦ç”¨åŒå‡»ç¼©æ”¾æ‰‹åŠ¿ï¼Œä½†ä¿ç•™æ»‘åŠ¨ */
            touch-action: manipulation;
        }

        /* --- ä¿®å¤ iOS PWA è¾“å…¥æ¡†æ— æ³•èšç„¦çš„é—®é¢˜ --- */
        input, textarea, [contenteditable] {
            -webkit-user-select: text !important;
            user-select: text !important;
            /* é˜²æ­¢ç‚¹å‡»é«˜äº®å¯¼è‡´çš„è§†è§‰å¹²æ‰° */
            -webkit-tap-highlight-color: transparent; 
        }
        /* 1. å®¹å™¨ï¼šç¡®ä¿ 4 ä¸ªå­—èƒ½éœ²å‡ºæ¥ */
        .marquee-box {
            position: relative;
            display: block;
            overflow: hidden;
            white-space: nowrap;
            width: 100%;
            /* å°†é®ç½©è¾¹ç¼˜ä» 5% å‹åˆ° 3%ï¼ŒæŠŠæ˜¾ç¤ºåŒºåŸŸæ’‘åˆ°æœ€å¤§ */
            mask-image: linear-gradient(to right, transparent, black 3%, black 97%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 3%, black 97%, transparent);
        }

        /* 2. åŠ¨ç”»ï¼šç»´æŒå•å‘å¾ªç¯ + ç²¾å‡†åœé  */
        .animate-marquee {
            position: relative;
            display: inline-block;
            min-width: 100%; 
            padding-left: 1px;
            animation: marquee-scroll 7s linear infinite; /* ç¨å¾®å‡é€Ÿï¼Œæ–¹ä¾¿é˜…è¯» */
        }

        @keyframes marquee-scroll {
            /* 0%-30%: åœåœ¨å¼€å¤´ï¼Œè®©ä½ çœ‹æ¸…å‰ 4 ä¸ªå­— */
            0%, 30% { 
                left: 0;
                transform: translateX(0);
            }
            /* 70%-85%: åˆšå¥½æ»šåŠ¨åˆ°æœ€åä¸€ä¸ªå­—è´´ä½å³è¾¹ç•Œï¼Œåœé¡¿çº¦ 1 ç§’ */
            70%, 85% { 
                left: 100%;
                transform: translateX(-100%);
            }
            /* 95%-100%: å¿«é€Ÿæ»‘å›å¼€å¤´é‡æ’­ */
            95%, 100% {
                left: 0;
                transform: translateX(0);
            }
        }
        /* ä¼˜åŒ–åçš„æ ·å¼ï¼Œè§£å†³è¾¹ç¼˜æ¼è‰² */
        .swipe-container {
            position: relative;
            overflow: hidden; /* å¿…é¡»æº¢å‡ºéšè—ï¼Œç¡®ä¿çº¢è‰²åº•å±‚ä¸è¶…å‡ºè¾¹ç•Œ */
            touch-action: pan-y;
            border-radius: 1rem; /* ä¸å¡ç‰‡åœ†è§’ä¿æŒä¸€è‡´ */
        }

        .swipe-content {
            position: relative;
            z-index: 2; /* ç¡®ä¿é¢å±‚åœ¨æœ€ä¸Šæ–¹ */
            width: 100%;
            background-color: inherit; /* ç»§æ‰¿çˆ¶çº§èƒŒæ™¯è‰² */
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .delete-action {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 80px;
            background-color: #ef4444; 
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1; /* åº•å±‚ */
            font-size: 12px;
            font-weight: bold;
            /* ç§»é™¤è¿™é‡Œçš„åœ†è§’è®¾ç½®ï¼Œäº¤ç»™çˆ¶å®¹å™¨ swipe-container çš„ overflow:hidden å¤„ç† */
        }
        /* âœ… æ–°å¢ï¼šå®ŒæˆæŒ‰é’®æ ·å¼ (ç»¿è‰²) */
        .complete-action {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 80px;
            background-color: #10b981; /* ç»¿è‰² */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            font-size: 12px;
            font-weight: bold;
        }

        /* ğŸš€ æ–°å¢ï¼šå·²å®Œæˆå†å²å¼¹çª—ä»åº•éƒ¨æ»‘å‡ºçš„åŠ¨ç”» */
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slide-up 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
        }
    </style> 
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 h-screen w-screen overflow-hidden flex flex-col font-sans transition-colors duration-300">
 <div id="splash-screen" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 transition-opacity duration-500">
        <div class="relative flex flex-col items-center">
            <img src="img/logo.png" alt="Logo" class="w-20 h-20 mb-4 object-contain animate-pulse">
            
            <div class="w-32 h-1 bg-gray-200 dark:bg-gray-800 rounded-full overflow-hidden">
                <div class="h-full bg-blue-600 w-1/2 animate-[shimmer_1s_infinite]"></div>
            </div>
            
            <p class="mt-4 text-xs font-bold text-gray-400 uppercase tracking-widest animate-pulse">Loading...</p>
        </div>
    </div>

    <style>
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }
    </style>   
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                var splash = document.getElementById('splash-screen');
                if (splash) {
                    splash.style.opacity = '0';
                    setTimeout(function(){ try { splash.remove(); } catch(e){} }, 500);
                }
            }, 1500);
        });
    </script>
<div id="app" 
     class="max-w-md mx-auto w-full h-full flex flex-col bg-white dark:bg-gray-900 shadow-2xl relative transition-colors duration-300" 
     @click="handleBackgroundClick"
     @dblclick.stop.prevent
     v-cloak>

    <div class="relative bg-blue-600 dark:bg-gray-800 text-white shadow-md z-40 flex-shrink-0 transition-all duration-300 border-b dark:border-gray-700 safe-top">
        
        <div class="flex flex-col w-full">
            <div class="px-4 pt-3 pb-1 flex justify-between items-center relative">
                
                <div class="flex items-center space-x-2 z-50">
                    <div class="flex justify-start items-center" @click="handleLogoClick">
                        <img src="img/logo.png" alt="Logo" class="w-8 h-8 object-contain rounded-lg bg-white/10 backdrop-blur-sm border border-white/10 shadow-sm transition-transform duration-200" :class="{'scale-75': isLogoAnimating}">
                    </div>

                    <button @click="currentTab = 'lab'" 
                            class="p-1.5 rounded-lg transition-all active:scale-95 flex items-center justify-center border border-white/20 bg-white/10 backdrop-blur-sm"
                            :class="currentTab === 'lab' ? 'ring-2 ring-white bg-white/20' : 'opacity-70'">
                        <span class="text-sm shadow-glow">ğŸ§ </span>
                    </button>
                </div>

                

                <div class="absolute left-1/2 -translate-x-1/2 z-50">
                    <div @click="handleTimerClick" class="bg-blue-700/50 dark:bg-gray-700/50 hover:bg-blue-700 dark:hover:bg-gray-700 rounded-full px-3 py-1.5 flex items-center space-x-2 cursor-pointer transition border border-blue-500/30 backdrop-blur-sm min-w-[6rem] justify-center select-none">
                        <span class="font-mono font-bold text-lg leading-none">
                            {{ isFocusing ? formatTime(timeLeft) : defaultDuration + ':00' }}
                        </span>
                        <span v-if="isFocusing" class="text-xs text-red-300 animate-pulse">â– </span>
                        <span v-else class="text-[10px] opacity-70">â–¼</span>
                    </div>

                    <div v-if="showTimeSelect" class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-32 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden animate-scale-up origin-top">
                        <div class="grid grid-cols-2 gap-1 p-1">
                            <div v-for="m in [10, 15, 25, 30, 45, 60]" :key="m" @click="setDuration(m)" class="py-2 text-center text-sm font-bold rounded-lg cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-700 transition" :class="defaultDuration === m ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-gray-700' : 'text-gray-600 dark:text-gray-300'">{{ m }}</div>
                        </div>
                    </div>
                    <div v-if="showTimerAction" class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-28 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden animate-scale-up origin-top p-1 space-y-1">
                        <button @click="stopTimer(true)" class="w-full py-2 text-xs font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700">å®Œæˆå¹¶è®°å½•</button>
                        <button @click="stopTimer(false)" class="w-full py-2 text-xs text-gray-500 hover:text-red-500 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg">æ”¾å¼ƒ</button>
                    </div>
                    <div v-if="showTimeSelect || showTimerAction" @click="closeTimerMenus" class="fixed inset-0 z-[-1]"></div>
                </div>

                <div class="flex items-center space-x-3">
                    <button @click="showSyncModal = true" class="opacity-80 hover:opacity-100 transition p-1">
                        <span v-if="syncStatus === 'success'" class="text-green-300">â˜ï¸âˆš</span>
                        <span v-else-if="syncStatus === 'loading'" class="animate-pulse">â˜ï¸...</span>
                        <span v-else>â˜ï¸</span>
                    </button>
                    
                    <button @click="toggleTheme" class="opacity-80 hover:opacity-100 transition p-1">
                        <span v-if="isDark">ğŸŒ™</span><span v-else>â˜€ï¸</span>
                     </button>
                </div>
            </div>

            <div v-if="['now', 'quadrant'].includes(currentTab)" class="px-4 pb-3 pt-2 flex items-stretch">
                
                <div class="flex-1 min-w-0 flex items-center">
                    <button @click="toggleCalendar" class="shrink-0 mr-2 w-8 h-10 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/90 border border-white/10 transition-all active:scale-95">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </button>

                    <div ref="dateScrollContainer" 
                    @touchstart="handleHeaderTouchStart" 
                    @touchend="handleHeaderTouchEnd" 
                    class="flex-1 flex overflow-x-auto no-scrollbar items-center space-x-3 mask-image-fade pr-1">
                            <div v-for="day in stripDays" 
                                :key="day.dateStr" 
                                :id="'day-' + day.dateStr"
                                @click="selectDate(day)" 
                                class="flex flex-col items-center justify-center space-y-1 cursor-pointer group shrink-0 w-10 py-1 transition-all duration-300 snap-center">
                            
                            <span class="text-[10px] opacity-60 font-medium">{{ day.weekName }}</span>
                            
                            <div class="w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold transition-all relative"
                                    :class="isSameDate(day.date, selectedDate) ? 'bg-white text-blue-600 shadow-lg scale-110' : 'hover:bg-blue-500/30 text-white/90'">
                                {{ day.dayNum }}
                                <div v-if="hasTask(day.date)" class="absolute bottom-1 w-1 h-1 rounded-full" 
                                        :class="isSameDate(day.date, selectedDate) ? 'bg-blue-600' : 'bg-white'"></div>
                            </div>
                            </div>
                            <div class="w-1 shrink-0"></div>
                    </div>

                    <transition name="fade">
                        <button v-if="!isSameDate(selectedDate, new Date())"
                                @click="jumpToToday"
                                class="shrink-0 ml-2 w-8 h-8 rounded-full border 0.26px border-white text-white shadow-lg font-bold text-xs flex items-center justify-center hover:bg-gray-50 active:scale-90 transition-all z-10">
                            ä»Š
                        </button>
                    </transition>
                </div>
                    
                <div class="w-px bg-blue-500/30 mx-2"></div>

                <div class="flex flex-col items-center justify-center">
                    <div class="text-4xl font-bold leading-none">{{ dailyDoneCount }}</div>
                    <div class="text-[10px] opacity-60 mt-1">ä»Šæ—¥æˆå°±</div>
                </div>
            </div>
            <div v-if="showCalendar && ['now', 'quadrant'].includes(currentTab)" 
                @click="toggleCalendar" 
                class="fixed inset-0 bg-black/30 z-40 cursor-pointer"
                style="touch-action: none;">
            </div>

            <div v-if="showCalendar || ['progress', 'countdown'].includes(currentTab)" 
                 class="bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 p-4 py-1.5 animate-fade-in border-t border-gray-100 dark:border-gray-700 transition-all"
                 :class="['now', 'quadrant'].includes(currentTab) ? 'absolute top-full left-0 w-full shadow-[0_100vh_0_100vh_rgba(0,0,0,0.5)] z-50 rounded-b-2xl' : 'relative w-full shadow-sm z-10'"
                 @touchstart="touchStart" @touchend="touchEnd">
                 
                 <div class="flex justify-between items-center mb-1">
                    <button @click.stop="changeMonth(-1)" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">â—€</button>
                    <div class="text-center" @click="jumpToToday">
                        <div class="font-bold text-lg">{{ currentYear }}å¹´ {{ currentMonth + 1 }}æœˆ</div>
                        <div class="text-xs text-blue-500 cursor-pointer">å›åˆ°ä»Šå¤©</div>
                    </div>
                    <button @click.stop="changeMonth(1)" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">â–¶</button>
                </div>
                 <div class="grid grid-cols-7 text-center text-sm text-gray-400 mb-0.5">
                    <span v-for="w in ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']">{{ w }}</span>
                </div>
                <div class="grid grid-cols-7 gap-x-1 gap-y- -2 text-center text-lg mb-0">
                    <div v-for="n in firstDayOfWeek"></div>
                    <div v-for="day in daysInMonth" @click="selectDate(day)" 
                            class="h-9 flex flex-col items-center justify-center rounded-lg cursor-pointer relative transition-all" 
                            :class="getDayClass(day)">
                        <span class="leading-none">{{ day.dayNum }}</span>
                        
                        <span class="text-[10px] leading-none -mt 0" :class="getLunarClass(day)">{{ day.lunarText }}</span>
                        
                        <div v-if="hasTask(day.date)" class="w-1 h-1 bg-blue-500 rounded-2xl mt-0.5"></div>
                    </div>
                </div>
                
                <div v-if="['now', 'quadrant'].includes(currentTab)" 
                     @click="toggleCalendar" 
                     class="text-center pt-2 border-t border-gray-100 dark:border-gray-700 text-gray-400 text-xs cursor-pointer">
                    â–² æ”¶èµ·æ—¥å†
                </div>
            </div>
            
        </div>
    </div>
    
   

    <div class="flex-1 overflow-hidden relative bg-white dark:bg-gray-900 flex flex-col">
        <div v-if="currentTab === 'lab'" class="h-full p-6 space-y-6 bg-slate-50 dark:bg-gray-950 overflow-y-auto pb-20">
            
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-xl font-bold text-indigo-600 dark:text-indigo-400 leading-none">è§‰é†’å®éªŒå®¤</h2>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest mt-1">Awakening Lab</p>
                </div>
                <button @click="showAiConfigModal = true" class="p-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 active:scale-95 transition">
                    <span class="text-sm">âš™ï¸ è®¾ç½®</span>
                </button>
            </div>

            <div class="space-y-6">
                <div class="flex space-x-2 overflow-x-auto no-scrollbar py-2 items-center">
                        <button v-for="id in identities" :key="id.id" 
                                @click="activeIdentity = id"
                                @touchstart="startIdentityPress(id)"
                                @touchend="clearIdentityPress"
                                @mousedown="startIdentityPress(id)"
                                @mouseup="clearIdentityPress"
                                class="shrink-0 px-4 py-2 rounded-2xl text-xs font-bold transition-all border"
                                :class="activeIdentity?.id === id.id ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white dark:bg-gray-800 text-gray-400'">
                            {{ id.icon }} {{ id.name }}
                        </button>

                        <button @click="openAddIdentityModal" 
                                class="shrink-0 w-10 h-10 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700 flex items-center justify-center text-gray-400">
                            ï¼‹
                        </button>
                    </div>

                    <div v-if="!activeIdentity" class="py-10 text-center space-y-4">
                        <div class="text-4xl">âœ¨</div>
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white">å¼€å§‹ä½ çš„è¿›åŒ–</h3>
                        <p class="text-xs text-gray-400 px-10 leading-relaxed">
                            ã€ŠåŸå­ä¹ æƒ¯ã€‹å‘Šè¯‰æˆ‘ä»¬ï¼šæ”¹å˜ä¹ æƒ¯æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯æ”¹å˜èº«ä»½è®¤åŒã€‚è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ï¼Œå‘Šè¯‰ AI ä½ æƒ³æˆä¸ºä»€ä¹ˆæ ·çš„äººã€‚
                        </p>
                    </div>

                    <div v-if="activeIdentity" class="animate-fade-in space-y-4">
                        </div>
            </div>                                                                                             

            <div class="space-y-6">
                <div v-if="activeIdentity" class="animate-fade-in space-y-4">
                    <div class="bg-white dark:bg-gray-800 rounded-3xl p-6 shadow-sm border border-indigo-50 dark:border-indigo-900/20">
                        <h3 class="text-indigo-600 font-black text-sm uppercase tracking-tighter mb-4">é¡¹ç›®è§£æä»ª</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-[10px] text-gray-400 font-bold uppercase">æ­£åœ¨æ¢ç´¢çš„é¡¹ç›®</label>
                                <div class="flex items-center space-x-2 border-b border-gray-100 dark:border-gray-700 py-1">
                                    <input v-model="web3Project.name" placeholder="ä¾‹å¦‚: ZKsync, é›…æ€å†™ä½œ..." 
                                        class="flex-1 bg-transparent py-1 outline-none text-lg font-bold">
                                    <button @click="runAiAnalysis" 
                                            :disabled="isAnalyzing"
                                            class="shrink-0 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 px-3 py-1.5 rounded-xl text-xs font-black active:scale-95 transition">
                                        {{ isAnalyzing ? 'è§£æä¸­...' : 'ğŸª„ AI è§£æ' }}
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="text-[10px] text-gray-400 font-bold uppercase">æ‹‰ä¼¸åŒºç›®æ ‡ (ä»Šæ—¥æ ¸å¿ƒ)</label>
                                <textarea v-model="web3Project.stretchGoal" placeholder="AI å°†ä¸ºä½ æ‹†è§£æ¸…æ™°ç›®æ ‡..." 
                                        class="w-full bg-gray-50 dark:bg-gray-900/50 rounded-xl p-3 mt-1 text-sm outline-none h-20"></textarea>
                            </div>

                            <div class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-2xl border border-indigo-100 dark:border-indigo-800/30">
                                <label class="text-[10px] text-indigo-400 font-bold uppercase">2åˆ†é’ŸåŸå­å…¥å£</label>
                                <div class="flex items-center mt-1">
                                    <span class="mr-2">âš¡</span>
                                    <input v-model="web3Project.atomicStart" placeholder="æç®€å¯åŠ¨åŠ¨ä½œ..." 
                                        class="bg-transparent w-full text-sm font-bold text-indigo-700 dark:text-indigo-300 outline-none">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="web3Project.suggestedSteps.length > 0" class="space-y-2 mt-4 px-1">
                        <label class="text-[10px] text-gray-400 font-bold uppercase block px-1">ç¡®è®¤åç»­è·¯å¾„ (å¯ç‚¹é€‰)</label>
                        <div v-for="(step, index) in web3Project.suggestedSteps" :key="index"
                            @click="step.selected = !step.selected"
                            class="flex items-start p-3 rounded-xl border transition-all cursor-pointer"
                            :class="step.selected ? 'bg-indigo-50 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800' : 'bg-transparent border-gray-100 dark:border-gray-800 opacity-40'">
                            <div class="mr-3 mt-0.5">
                                <div v-if="step.selected" class="text-indigo-600 text-xs">â—</div>
                                <div v-else class="w-2 h-2 rounded-full border border-gray-400"></div>
                            </div>
                            <span class="text-xs font-medium" :class="step.selected ? 'text-indigo-900 dark:text-indigo-200' : 'text-gray-400'">
                                {{ step.text }}
                            </span>
                        </div>
                    </div>

                    <button @click="startEvolution" 
                            class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-xl shadow-indigo-200 dark:shadow-none active:scale-95 transition-transform mt-4">
                        ä»¥æ­¤èº«ä»½å¼€å§‹è¿›åŒ–
                    </button>
                </div>
            </div>
        </div>
        
     <div v-if="currentTab === 'now'" class="h-full flex flex-col">
            
            <div class="shrink-0 bg-white dark:bg-gray-900 z-30 pt-4 px-4 pb-3 shadow-sm/50">

                <div class="flex items-center bg-gray-100 dark:bg-gray-800 rounded-2xl p-1.5 transition-all shadow-inner dark:shadow-none ring-1 ring-transparent focus-within:bg-white dark:focus-within:bg-gray-700 focus-within:ring-blue-100 dark:focus-within:ring-blue-900/50 focus-within:shadow-md">
                    <div class="bg-blue-600 text-white text-xs font-black px-3 h-8 rounded-full flex items-center justify-center shadow-lg shadow-blue-500/30 mr-2 shrink-0 select-none">
                        ä»Šæ—¥ä¸“æ³¨
                    </div>
                    <input v-model="newTask" @keyup.enter="addTask" 
                    @click.stop @touchstart.stop
                    autocomplete="off"
                    type="text" placeholder="æ·»åŠ å¾…åŠ..." class="bg-transparent flex-1 px-3 py-1 outline-none text-sm min-w-0 dark:text-white dark:placeholder-gray-500 font-medium text-gray-700 placeholder-gray-400">
                    
                    <div class="relative mr-1 h-full flex items-center">
                        <select v-model="newDuration" 
                                class="appearance-none bg-white dark:bg-gray-600 dark:text-white text-xs px-2.5 py-1.5 rounded-xl outline-none text-center text-gray-600 font-bold shadow-sm focus:text-blue-600 transition-colors">
                            <option value="" disabled selected>min</option>
                            <option v-for="m in [15, 30, 45, 60, 90, 120, 180]" :key="m" :value="m">
                                {{ m }}
                            </option>
                        </select>
                    </div>
                    <button @click="addTask" class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg shadow-blue-500/30 hover:bg-blue-700 active:scale-90 transition transform">ï¼‹</button>
                </div>
            </div>

            <div class="flex-1 flex flex-col min-h-0 overflow-hidden relative">
                <div class="flex-1 overflow-y-auto px-4 py-2 space-y-2">
                    <div v-for="task in activeRecurringQuadrantTasks" :key="task.id" 
                        class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm mb-2.5 overflow-hidden transition-all duration-300 ring-1 ring-gray-100/50 dark:ring-white/5 hover:shadow-md relative group">
                        
                        <div class="absolute top-[-2px] right-12 w-24 text-left text-[56px] font-black opacity-[0.06] select-none pointer-events-none"
                            :class="{'text-red-500': task.q===1, 'text-blue-500': task.q===2, 'text-yellow-500': task.q===3}">
                            Q{{ task.q }}
                        </div>

                        <div class="p-3 flex items-center cursor-pointer active:bg-gray-50 dark:active:bg-gray-700/50 transition-colors"
                            @touchstart="handleTouchStart(task, $event)"
                            @touchmove="handleTouchMove($event)"
                            @touchend="handleTouchEnd(task)" 
                            @click="handleTaskClick(task)">
                            
                            <button @touchstart.stop @touchend.stop @click.stop="toggleTask(task)" class="mr-3 shrink-0 p-1 -ml-1 opacity-80">
                                <div class="w-5 h-5 border-2 border-gray-300 text-gray-300 rounded-full transition-all duration-300 hover:border-blue-600 hover:text-blue-600">
                                </div>
                            </button>

                            <div class="flex-1 min-w-0 pr-4"> <span class="font-medium text-sm text-gray-700 dark:text-gray-200 truncate block leading-relaxed">
                                    {{ task.text }}
                                </span>
                                <div v-if="task.duration > 0" class="mt-1 h-1 w-24 bg-red-100 dark:bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-blue-500 rounded-full" :style="{ width: Math.min((task.accumulated || 0) / task.duration * 100, 100) + '%' }"></div>
                                </div>
                            </div>

                            <div class="flex items-center space-x-2 ml-2">
                                <button @touchstart.stop @touchend.stop @click.stop="startTimer(task)" class="text-gray-300 hover:text-blue-600 p-1 transition-colors">â–¶</button>
                                <div class="text-gray-300 transition-transform duration-300 text-xs px-1" :class="{'rotate-180': task.expanded}">â–¼</div>
                            </div>
                        </div>

                        <div v-if="task.expanded" class="bg-gray-50 dark:bg-gray-900/50 border-t border-gray-100 dark:border-gray-700 px-3 py-2 animate-fade-in">
                            <div v-if="task.subtasks && task.subtasks.length > 0" class="space-y-1 mb-2">
                                <div v-for="sub in task.subtasks" :key="sub.id" class="flex items-start group/sub">
                                    <button @click.stop="toggleSubtask(sub)" class="mr-2 mt-0.5 text-gray-400 hover:text-blue-500 shrink-0">
                                        <div v-if="sub.done" class="text-blue-500 text-xs">â˜‘</div>
                                        <div v-else class="w-3 h-3 border border-current rounded-sm"></div>
                                    </button>
                                    <div class="flex-1 flex items-center min-w-0">
                                        <input v-if="sub.editing" 
                                            v-model="sub.text" 
                                            @blur="sub.editing = false" 
                                            @keyup.enter="$event.target.blur()"
                                            v-focus
                                            class="w-full bg-transparent border-none outline-none text-xs text-blue-600 dark:text-blue-400 font-medium py-0 px-0 m-0 leading-tight">
                                        
                                        <span v-else 
                                            @click="handleSubtaskClick(sub)" 
                                            :class="{'line-through text-gray-400': sub.done}" 
                                            class="text-xs text-gray-600 dark:text-gray-300 flex-1 break-all leading-tight pt-0.5 cursor-text select-none">
                                            {{ sub.text }}
                                        </span>
                                    </div>
                                    <button @click.stop="deleteSubtask(task, sub.id)" class="text-gray-300 hover:text-red-400 ml-1 px-1 text-[10px]">Ã—</button>
                                </div>
                            </div>
                            <div class="flex items-center bg-white dark:bg-gray-800 rounded px-2 py-1 border border-gray-100 dark:border-gray-600">
                                <span class="text-gray-400 text-xs mr-2">â†³</span>
                                <input type="text" placeholder="æ·»åŠ æ­¥éª¤..." class="flex-1 bg-transparent text-xs outline-none text-gray-600 dark:text-gray-300 placeholder-gray-400" @click.stop @keyup.enter="addSubtask(task, $event)" @blur="addSubtask(task, $event)">
                            </div>
                        </div>
                    </div>
                    <div v-if="activeInboxTasks.length === 0 && activeRecurringQuadrantTasks.length === 0" class="text-center py-10 opacity-30 text-gray-500 dark:text-gray-400">
                        <p class="text-xs">æš‚æ— è¿›è¡Œä¸­çš„ä»»åŠ¡</p>
                    </div>

                    <div v-for="task in activeInboxTasks" :key="task.id" 
                        class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm mb-2.5 overflow-hidden transition-all duration-300 ring-1 ring-gray-100/50 dark:ring-white/5 hover:shadow-md">
                        
                        <div class="p-3 flex items-center group relative cursor-pointer active:bg-gray-50 dark:active:bg-gray-700/50 transition-colors"
                            @touchstart="handleTouchStart(task, $event)"
                            @touchmove="handleTouchMove($event)"
                            @touchend="handleTouchEnd(task)" 
                            @click="handleTaskClick(task)"
                            @mousedown="handleTouchStart(task)" 
                            @mouseup="handleTouchEnd(task)"
                            @mouseleave="handleTouchMove">
                            
                            <button @touchstart.stop @touchend.stop @mousedown.stop @mouseup.stop @click.stop="toggleTask(task)" class="mr-3 shrink-0 p-1 -ml-1 opacity-80">
                                <div class="w-5 h-5 border-2 rounded-full transition-all duration-300" 
                                    :class="isTaskDone(task, selectedDate) ? 'bg-blue-600 border-blue-600' : 'border-gray-300 text-gray-300'">
                                </div>
                            </button>

                            <div class="flex-1 min-w-0">
                                <span class="font-medium text-sm text-gray-700 dark:text-gray-200 truncate block leading-relaxed">
                                    {{ task.text }}
                                </span>
                                <div v-if="task.duration > 0" class="mt-1 h-1 w-24 bg-red-100 dark:bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-blue-500 rounded-full" :style="{ width: Math.min((task.accumulated || 0) / task.duration * 100, 100) + '%' }"></div>
                                </div>
                            </div>

                            <div class="flex items-center space-x-2 ml-2">
                                <button v-if="!isTaskDone(task, selectedDate)" @touchstart.stop @touchend.stop @click.stop="startTimer(task)" class="text-gray-300 hover:text-blue-600 p-1 transition-colors">â–¶</button>
                                <div class="text-gray-300 transition-transform duration-300 text-xs px-1" :class="{'rotate-180': task.expanded}">â–¼</div>
                            </div>
                        </div>

                        <div v-if="task.expanded" class="bg-gray-50 dark:bg-gray-900/50 border-t border-gray-100 dark:border-gray-700 px-3 py-2 animate-fade-in">
                            <div v-if="task.subtasks && task.subtasks.length > 0" class="space-y-1 mb-2">
                                <div v-for="sub in task.subtasks" :key="sub.id" class="flex items-start group/sub">
                                    <button @click.stop="toggleSubtask(sub)" class="mr-2 mt-0.5 text-gray-400 hover:text-blue-500 shrink-0">
                                        <div v-if="sub.done" class="text-blue-500 text-xs">â˜‘</div>
                                        <div v-else class="w-3 h-3 border border-current rounded-sm"></div>
                                    </button>
                                    <div class="flex-1 flex items-center min-w-0">
                                        <input v-if="sub.editing" 
                                            v-model="sub.text" 
                                            @blur="sub.editing = false" 
                                            @keyup.enter="$event.target.blur()"
                                            v-focus
                                            class="w-full bg-transparent border-none outline-none text-xs text-blue-600 dark:text-blue-400 font-medium py-0 px-0 m-0 leading-tight">
                                        
                                        <span v-else 
                                            @click="handleSubtaskClick(sub)" 
                                            :class="{'line-through text-gray-400': sub.done}" 
                                            class="text-xs text-gray-600 dark:text-gray-300 flex-1 break-all leading-tight pt-0.5 cursor-text select-none">
                                            {{ sub.text }}
                                        </span>
                                    </div>
                                    <button @click.stop="deleteSubtask(task, sub.id)" class="text-gray-300 hover:text-red-400 ml-1 px-1 text-[10px]">Ã—</button>
                                </div>
                            </div>
                            <div class="flex items-center bg-white dark:bg-gray-800 rounded px-2 py-1 border border-gray-100 dark:border-gray-600">
                                <span class="text-gray-400 text-xs mr-2">â†³</span>
                                <input type="text" placeholder="æ·»åŠ æ­¥éª¤..." class="flex-1 bg-transparent text-xs outline-none text-gray-600 dark:text-gray-300 placeholder-gray-400" @click.stop @keyup.enter="addSubtask(task, $event)" @blur="addSubtask(task, $event)">
                            </div>
                        </div>
                    </div>

                    <div v-if="completedInboxTasks.length > 0" class="mt-4 mb-10">
                        <button @click="showCompletedInbox = !showCompletedInbox" 
                                class="w-full py-2 flex items-center justify-center space-x-2 text-gray-400 hover:text-blue-500 transition-colors">
                            <div class="h-px flex-1 bg-gray-100 dark:bg-gray-800"></div>
                            <span class="text-[10px] font-bold tracking-widest uppercase">
                                {{ showCompletedInbox ? 'éšè—å·²å®Œæˆ' : 'æŸ¥çœ‹ ' + completedInboxTasks.length + ' é¡¹å·²å®Œæˆ' }}
                            </span>
                            <div class="h-px flex-1 bg-gray-100 dark:bg-gray-800"></div>
                        </button>

                        <div v-if="showCompletedInbox" class="mt-3 space-y-2 opacity-60">
                            <div v-for="task in completedInboxTasks" :key="task.id" 
                                class="bg-gray-50/50 dark:bg-gray-800/40 rounded-xl px-3 py-2 flex items-center border border-dashed border-gray-100 dark:border-gray-700">
                                <button @click.stop="toggleTask(task)" class="mr-3 opacity-80">
                                    <div class="w-4 h-4 bg-blue-600 rounded-full flex items-center justify-center text-white text-[8px]">âœ“</div>
                                </button>
                                <span class="line-through text-xs text-gray-400 truncate">{{ task.text }}</span>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <div class="shrink-0 h-36 bg-gray-50 dark:bg-gray-950 grid grid-cols-2 gap-0 px-4 pb-3 pt-2">
                
                <div class="flex flex-col overflow-hidden border-r border-gray-200 dark:border-gray-800 pr-3" @dblclick.stop style="touch-action: none;">
                    <div class="py-2 flex items-center justify-between shrink-0">
                         <div class="flex items-center">
                            <div class="h-2 w-2 bg-orange-400 rounded-full mr-2"></div>
                            <span class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">å››è±¡é™</span>
                         </div>
                         <button @click="currentTab='quadrant'" class="text-[10px] text-blue-500 font-bold">å…¨éƒ¨ ></button>
                    </div>
                    
                    <div class="flex-1 grid grid-rows-2 grid-flow-col gap-2 auto-cols-[90%] overflow-x-auto no-scrollbar items-center pb-1">
                         <div v-if="activeQuadrantTasks.length === 0" class="row-span-2 w-full flex items-center justify-center text-xs text-gray-300">æ— ä»»åŠ¡</div>
                         
                         <div v-for="task in activeQuadrantTasks" :key="task.id" 
                              @click="handleTileClick(task)"
                              class="flex items-center justify-between w-full h-full rounded-xl px-3 py-1.5 relative active:scale-95 transition-transform shadow-sm"
                              :class="{
                                // ç”¨èƒŒæ™¯è‰²åŒºåˆ†ä¼˜å…ˆçº§ï¼Œå»æ‰è¾¹æ¡†
                                'bg-red-50/80 dark:bg-red-900/20': task.q===1,
                                'bg-blue-50/80 dark:bg-blue-900/20': task.q===2,
                                'bg-yellow-50/80 dark:bg-yellow-900/20': task.q===3,
                                'bg-white dark:bg-gray-800': task.q===4
                              }">
                            
                            <button @touchstart.stop @click.stop="toggleTask(task)" class="mr-2 shrink-0 p-1 -ml-1 opacity-60">
                                <div class="w-3.5 h-3.5 border-2 border-current rounded-full transition-all" 
                                    :class="isTaskDone(task, selectedDate) ? 'bg-blue-600 border-blue-600 opacity-100' : 'text-gray-300 border-gray-300'">
                                </div>
                            </button>

                            <div class="flex-1 min-w-0 flex flex-col justify-center mr-1">
                                <span class="text-xs font-bold text-gray-700 dark:text-gray-200 truncate leading-none">{{ task.text }}</span>
                                <div class="flex items-center mt-1 opacity-60">
                                    <span class="text-[9px] font-black" :class="{'text-red-500': task.q===1, 'text-blue-500': task.q===2, 'text-yellow-600': task.q===3}">Q{{task.q}}</span>
                                    <span v-if="task.startDate" class="ml-1 text-[8px] font-medium">{{ task.startDate.slice(5) }}</span>
                                </div>
                            </div>

                            <div class="flex flex-col items-end justify-between self-stretch py-0.5">
                                <button @touchstart.stop @click.stop="startTimer(task)" class="text-blue-500/80 active:scale-90 transition">
                                    <svg class="w-3.5 h-3.5 fill-current" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                </button>
                                <span class="text-[8px] font-mono text-gray-400 mt-auto leading-none">{{ (task.accumulated || 0).toFixed(1) }}h</span>
                            </div>
                         </div>
                    </div>
                </div>

                <div class="flex flex-col overflow-hidden pl-3" @dblclick.stop style="touch-action: none;">
                    <div class="py-2 flex items-center shrink-0">
                        <div class="h-2 w-2 bg-pink-400 rounded-full mr-2"></div>
                        <span class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">è¿‘æœŸé‡è¦</span>
                    </div>

                    <div ref="upcomingScroll" 
                        class="flex-1 overflow-x-auto whitespace-nowrap flex items-start gap-2 pr-2 no-scrollbar pb-1" 
                        @touchstart="pauseUpcoming" 
                        @touchend="resumeUpcoming">
                        <div v-if="homeUpcomingList.length === 0" class="w-full text-xs text-gray-300 text-center py-6">æ— è¿‘æœŸäº‹é¡¹</div>
                        
                        <div v-for="(day, index) in displayUpcomingList" :key="index" 
                            class="inline-flex flex-col shrink-0 w-[43%] h-full bg-blue-50/60 dark:bg-gray-800 rounded-2xl px-2 py-2.5 relative overflow-hidden active:scale-95 transition-transform border border-gray-100 dark:border-gray-800/50">
                            
                            <div class="absolute -right-2 -bottom-2 text-5xl opacity-[0.03] select-none pointer-events-none rotate-12">â³</div>

                            <div class="mb-0.5 w-full">
                                <div class="marquee-box w-full">
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200"
                                        :class="{'animate-marquee': day.name.length > 4}">
                                        {{ day.name }}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="flex items-baseline space-x-0.5 my-auto">
                                <span class="text-2xl font-black text-blue-600 dark:text-blue-400 leading-none">
                                    {{ Math.abs(getDaysUntilData(day).days) }}
                                </span>
                                <span class="text-[10px] font-bold text-blue-300/80">å¤©å</span>
                            </div>
                            
                            <div class="mt-auto flex items-center overflow-hidden">
                                <span class="text-[9px] font-bold text-gray-400/60 leading-none truncate">
                                    {{ day.date.slice(5) }}
                                </span>
                                
                                <span v-if="day.isLunar" class="ml-1 text-[8px] bg-red-100 text-red-600 px-1 py-[1px] rounded-[3px] font-bold leading-none shrink-0">å†œ</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        
<div v-if="currentTab === 'quadrant'" class="h-full flex flex-col overflow-hidden bg-gray-100 dark:bg-gray-900">
    
    <div class="flex-1 quadrant-grid text-sm overflow-hidden">
        <div v-for="q in [1,2,3,4]" :key="q" class="q-cell relative group flex flex-col overflow-hidden"
             :class="{'border-b border-r border-red-100 dark:border-red-900/30': q===1, 'border-b border-blue-100 dark:border-blue-900/30': q===2, 'border-r border-yellow-100 dark:border-yellow-900/30': q===3, 'border-gray-100 dark:border-gray-700': q===4}">
            
            <div class="shrink-0 text-[11px] font-black mb-2 bg-white/95 dark:bg-gray-800/95 p-1 z-10 flex justify-between items-center text-gray-400 uppercase tracking-tighter">
                <span :class="{'text-red-500': q===1, 'text-blue-500': q===2, 'text-yellow-600': q===3}">{{ quadrantTitles[q-1] }}</span>
                <button @click="addQuickTask(q)" class="text-lg leading-none hover:text-blue-600 w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition">+</button>
            </div>

            <div class="flex-1 overflow-y-auto no-scrollbar space-y-1 pr-0.5">
                <div v-for="t in getTasksByQ(q).filter(x => !isTaskDone(x, selectedDate))" :key="t.id" 
                     class="bg-white dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700 shadow-sm overflow-hidden shrink-0">
                    
                    <div class="h-14 relative flex items-center px-3 cursor-pointer active:bg-gray-50 dark:active:bg-gray-700/50 transition-colors"
                        @touchstart="handleTouchStart(t, $event)"
                        @touchmove="handleTouchMove($event)"
                        @touchend="handleTouchEnd(t)" 
                        @click="handleTaskClick(t)">
                        
                        <button @touchstart.stop @touchend.stop @click.stop="toggleTask(t)" class="mr-3 shrink-0 p-1 -ml-1 opacity-80">
                            <div class="w-5 h-5 border-2 rounded-full transition-all duration-300" 
                                :class="isTaskDone(t, selectedDate) ? 'bg-blue-600 border-blue-600' : 'border-gray-300 text-gray-300'">
                            </div>
                        </button>

                        <div class="flex-1 flex flex-col justify-center min-w-0 pr-10"> 
                            <div class="marquee-box w-full">
                                <div :class="{'animate-marquee': t.text.length > 10}" 
                                     class="text-sm font-medium text-gray-700 dark:text-gray-200 leading-tight inline-block truncate">
                                    {{ t.text }}
                                </div>
                            </div>
                            <div v-if="t.duration > 0" class="mt-1.5 h-1 w-full bg-red-50 dark:bg-gray-600 rounded-full overflow-hidden">
                                <div class="h-full bg-blue-500" :style="{width: Math.min((t.accumulated||0)/t.duration*100, 100) + '%'}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div @click="addQuickTask(q)"  -->
               <!-- class="shrink-0 h-7 mt-1 flex items-center justify-center text-gray-300 dark:text-gray-600 hover:text-blue-500 active:bg-blue-50 rounded-lg border border-dashed border-gray-100 dark:border-gray-700 transition-colors cursor-pointer text-[9px] font-bold tracking-widest uppercase"> -->
                <!-- + Quick Add -->
            <!-- </div> -->
        </div>
    </div>

    <div @click="showDoneHistory = true" 
         class="shrink-0 h-11 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex items-center justify-center space-x-2 active:bg-gray-50 dark:active:bg-gray-700/50 transition-colors cursor-pointer select-none">
        <span class="text-[10px] text-gray-400 font-black uppercase tracking-widest">æŸ¥çœ‹å·²å®Œæˆæ˜ç»†</span>
        <span class="bg-blue-600 text-white px-2 py-0.5 rounded-full text-[9px] font-black min-w-[1.4rem] text-center shadow-sm">
            {{ allCompletedTasks.length }}
        </span>
    </div>

    <div v-if="showDoneHistory" 
         class="fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4 animate-fade-in"
         @click.self="showDoneHistory = false">
        
        <div class="bg-white dark:bg-gray-900 w-full max-w-sm h-[80dvh] rounded-[2.5rem] flex flex-col overflow-hidden shadow-2xl animate-scale-up relative">
            
            <div class="bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700 px-6 py-6 flex flex-col items-center">
                <span class="font-bold text-sm text-gray-800 dark:text-gray-100">ä»»åŠ¡å®Œæˆæ˜ç»†</span>
                <span class="text-[9px] text-gray-400 font-black tracking-widest uppercase mt-0.5">Archive Manager</span>
            </div>
            
            <div class="flex-1 overflow-y-auto no-scrollbar pb-32">
                <table class="w-full text-left border-collapse">
                    <thead class="sticky top-0 bg-gray-50/90 dark:bg-gray-800/90 backdrop-blur-md z-10">
                        <tr class="text-[9px] text-gray-400 font-black uppercase tracking-tighter border-b dark:border-gray-700">
                            <th class="pl-6 py-3">ä»»åŠ¡å / æ—¶é—´</th>
                            <th class="px-2 py-3 text-center">æ¥æº</th>
                            <th class="pr-6 py-3 text-right">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-50 dark:divide-gray-800">
                        <tr v-for="t in allCompletedTasks" :key="t.id" class="active:bg-gray-50 dark:active:bg-gray-800/50">
                            <td class="pl-6 py-4">
                                <div class="text-xs font-bold text-gray-700 dark:text-gray-200 truncate max-w-[150px]">{{ t.text }}</div>
                                <div class="text-[9px] text-gray-400 mt-1 font-mono uppercase">{{ t.completedAt }}</div>
                            </td>
                            <td class="px-2 py-4 text-center">
                                <span :class="{'text-red-500': t.q===1, 'text-blue-500': t.q===2, 'text-yellow-600': t.q===3}" class="text-[10px] font-black italic">Q{{t.q}}</span>
                            </td>
                            <td class="pr-6 py-4 text-right">
                                <button @click="restoreTask(t)" class="text-[10px] font-black text-blue-600 bg-blue-50 dark:bg-blue-900/30 px-3 py-1.5 rounded-lg active:scale-90 transition-transform">å¤æ´»</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div v-if="allCompletedTasks.length === 0" class="flex flex-col items-center justify-center py-20 opacity-20">
                    <span class="text-4xl mb-2">ğŸ“„</span>
                    <p class="text-[10px] font-black uppercase tracking-widest">æš‚æ— è®°å½•</p>
                </div>
            </div>

            <div class="absolute bottom-6 left-0 w-full px-6 flex justify-center">
                <button @click="showDoneHistory = false" 
                        class="w-2/3 h-12 bg-blue-600 text-white rounded-full font-black text-sm shadow-[0_10px_30px_-5px_rgba(37,99,235,0.6)] active:scale-95 transition-all flex items-center justify-center select-none">
                    å…³é—­å¼¹çª—
                </button>
            </div>
        </div>
    </div>
</div>

<div v-if="showRestoreModal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/30 backdrop-blur-[2px] animate-fade-in px-8" @click.self="showRestoreModal = false">
        <div class="bg-white/90 dark:bg-gray-800/90 w-full max-w-[18rem] rounded-2xl overflow-hidden shadow-2xl animate-scale-up border border-white/20 dark:border-gray-700 backdrop-blur-xl transition-all">
            
            <div class="pt-6 pb-4 px-6 text-center">
                <div class="mx-auto w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-3 text-2xl animate-bounce-slow">
                    ğŸŒ±
                </div>
                
                <h3 class="text-base font-bold text-gray-800 dark:text-white mb-2">å¤æ´»ä»»åŠ¡</h3>
                
                <p class="text-xs text-gray-500 dark:text-gray-300 leading-relaxed px-2">
                    {{ restorePromptText }}
                </p>
            </div>

            <div class="grid grid-cols-2 border-t border-gray-200/50 dark:border-gray-700/50 divide-x divide-gray-200/50 dark:divide-gray-700/50">
                <button @click="showRestoreModal = false" 
                        class="py-3.5 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 active:bg-gray-100 transition-colors">
                    å†æƒ³æƒ³
                </button>
                <button @click="confirmRestore" 
                        class="py-3.5 text-sm font-bold text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 active:bg-blue-100 transition-colors">
                    ç¡®å®šå¤æ´»
                </button>
            </div>
        </div>
    </div>

        <div v-if="currentTab === 'progress'" class="h-full p-4 overflow-y-auto bg-gray-50 dark:bg-gray-900 space-y-4 pb-20">
    
    <div class="bg-gradient-to-br from-blue-600 to-blue-500 rounded-2xl p-5 text-white shadow-md shadow-blue-500/20 flex justify-between items-center relative overflow-hidden">
            
            <div class="absolute -right-6 -bottom-6 text-9xl opacity-10 rotate-12 select-none">ğŸ†</div>

            <div class="relative z-10">
                <p class="text-[10px] font-bold opacity-70 uppercase tracking-wider mb-1">ç´¯è®¡ä¸“æ³¨æŠ•å…¥</p>
                <div class="flex items-baseline">
                    <h3 class="text-4xl font-black tracking-tight">{{ progressStats.hours }}</h3>
                    <span class="text-sm font-medium opacity-80 ml-1">h</span>
                </div>
            </div>
            
            <div class="w-px h-10 bg-white/20 mx-4 relative z-10"></div>

            <div class="text-right relative z-10">
                <p class="text-[10px] font-bold opacity-70 uppercase tracking-wider mb-1">å·²è¾¾æˆç›®æ ‡</p>
                <div class="flex items-baseline justify-end">
                    <h3 class="text-3xl font-black">{{ progressStats.doneCount }}</h3>
                    <span class="text-sm font-medium opacity-60 ml-1">/ {{ progressStats.totalCount }}</span>
                </div>
            </div>
        </div>

    <div class="space-y-3">
        <div v-if="activeProgressTasks.length === 0" class="py-10 text-center text-gray-400 text-xs">
            æš‚æ— åŒ…å«å·¥æ—¶çš„è¿›è¡Œä¸­ä»»åŠ¡
        </div>
        
        <div v-for="task in activeProgressTasks" :key="task.id" class="swipe-container mb-3 shadow-sm rounded-2xl">
            
            <div @click.stop="handleProgressComplete(task)" class="complete-action">
                å®Œæˆ
            </div>

            <div @touchstart="handleSwipeStart($event, task.id)"
                 @touchmove="handleSwipeMove($event, task.id)"
                 @touchend="handleSwipeEnd($event, task.id)"
                 @click="swipeItemId === task.id ? swipeItemId = null : handleProgressItemClick(task)"
                 class="swipe-content bg-white dark:bg-gray-800 rounded-2xl p-4 border border-gray-100 dark:border-gray-700 active:scale-[0.98] transition-all"
                 :style="{ transform: swipeItemId === task.id ? 'translateX(-80px)' : 'translateX(0)' }">
                
                <div class="flex justify-between items-start mb-2">
                    <div class="flex-1 min-w-0 pr-4">
                        <div class="flex items-center space-x-2">
                             <div v-if="isTaskDone(task, selectedDate)" class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-[10px] px-1.5 py-0.5 rounded font-bold shrink-0 flex items-center">
                                âœ“ ä»Šæ—¥å·²åš
                            </div>

                            <span class="font-bold text-gray-800 dark:text-gray-200 truncate" 
                                :class="{'opacity-50 line-through': isTaskDone(task, selectedDate)}">
                                {{ task.text }}
                            </span>
                            
                            <span class="text-[9px] bg-gray-100 dark:bg-gray-700 text-gray-500 px-1.5 py-0.5 rounded font-black shrink-0">Q{{ task.q }}</span>
                        </div>
                    </div>
                    <div class="text-right shrink-0 flex flex-col items-end justify-center">
                        <span class="text-xs font-black text-blue-600 dark:text-blue-400 mb-0.5">
                            {{ task.duration > 0 ? Math.min(((task.accumulated || 0) / task.duration * 100), 100).toFixed(0) : 0 }}%
                        </span>
                        <span class="text-[10px] text-gray-400 font-medium font-mono">
                            {{ (task.accumulated || 0).toFixed(1) }} / {{ Number(task.duration).toFixed(1) }}h
                        </span>
                    </div>
                </div>

                <div class="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-blue-500 rounded-full transition-all duration-500" 
                         :style="{ width: Math.min((task.accumulated || 0) / task.duration * 100, 100) + '%' }">
                    </div>
                </div>
                
                <div v-if="task.expanded" class="mt-4 pt-3 border-t border-gray-50 dark:border-gray-700 animate-fade-in">
                   <p class="text-[10px] text-gray-400 uppercase font-bold mb-2">æœ€è¿‘ä¸“æ³¨è®°å½•</p>

                        <div v-if="task.log && task.log.length > 0" 
                            class="space-y-1.5 max-h-16 overflow-y-auto no-scrollbar overscroll-contain"
                            @touchstart.stop
                            @touchmove.stop
                            @touchend.stop>
                            
                            <div v-for="(entry, index) in task.log" :key="index" class="flex justify-between text-[10px]">
                                <span class="text-gray-500">{{ entry.date }}</span>
                                <span class="font-mono" 
                                    :class="entry.duration > 0 ? 'text-blue-500' : 'text-red-500'">
                                    {{ entry.duration > 0 ? '+' : '' }}{{ entry.duration.toFixed(1) }}h
                                </span>
                            </div>
                        </div>
                        <p v-else class="text-[10px] text-gray-400 italic">å°šæ— ä¸“æ³¨è®°å½•</p>
                        <div class="mt-3 flex justify-center">
                        <button @click.stop="editTaskProgress(task)" class="text-[10px] font-bold text-blue-600 bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-full">æ‰‹åŠ¨å¾®è°ƒå·¥æ—¶</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="completedProgressTasks.length > 0" class="mt-6">
        <button @click="showCompletedProgress = !showCompletedProgress" 
                class="w-full py-2 flex items-center justify-center space-x-2 text-gray-400 hover:text-blue-500 transition-colors">
            <div class="h-px flex-1 bg-gray-200 dark:bg-gray-800"></div>
            <span class="text-[10px] font-bold tracking-widest uppercase">
                {{ showCompletedProgress ? 'éšè—å·²å®Œæˆ' : 'æŸ¥çœ‹ ' + completedProgressTasks.length + ' é¡¹å·²å®Œæˆ' }}
            </span>
            <div class="h-px flex-1 bg-gray-200 dark:bg-gray-800"></div>
        </button>

        <div v-if="showCompletedProgress" class="mt-3 space-y-2 opacity-60">
            <div v-for="task in completedProgressTasks" :key="task.id" 
                class="bg-gray-50/50 dark:bg-gray-800/40 rounded-xl p-3 flex items-center justify-between border border-dashed border-gray-200 dark:border-gray-700">
                <div class="flex items-center min-w-0">
                    <div class="w-4 h-4 bg-blue-600 rounded-full flex items-center justify-center text-white text-[8px] mr-2">âœ“</div>
                    <span class="line-through text-xs text-gray-500 truncate">{{ task.text }}</span>
                </div>
                <span class="text-[10px] font-mono text-gray-400">{{ (task.accumulated || 0).toFixed(1) }} / {{ task.duration }}h</span>
            </div>
        </div>
    </div>
</div>

        <div v-if="currentTab === 'countdown'" class="h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden">
    
    <div class="shrink-0 flex justify-between items-center px-5 py-4 bg-white dark:bg-gray-900 z-20 border-b border-gray-100 dark:border-gray-800">
        <div>
            <h2 class="text-xl font-bold text-gray-800 dark:text-white">é‡è¦æ—¶åˆ»</h2>
            <p class="text-[10px] text-gray-400 font-medium uppercase tracking-widest mt-0.5">Countdown Moments</p>
        </div>
        
        <button @click="openCountdownModal('add')" class="bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 active:scale-90 transition shadow-blue-200 dark:shadow-none">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
        </button>
    </div>

    <div class="flex-1 overflow-y-auto p-4 pt-2 pb-24">
        
        <div v-if="upcomingList.length > 0" class="space-y-3 mb-6">
    <div v-for="day in upcomingList" :key="day.id" class="swipe-container mb-3">
        
        <div @click.stop="deleteCountdown(day.id)" class="delete-action">
            åˆ é™¤
        </div>

        <div @touchstart="handleSwipeStart($event, day.id)"
             @touchmove="handleSwipeMove($event, day.id)"
             @touchend="handleSwipeEnd($event, day.id)"
             @click="swipeItemId === day.id ? swipeItemId = null : openCountdownModal('edit', day)"
             class="swipe-content bg-white dark:bg-gray-800 rounded-2xl p-4 flex items-center shadow-sm border border-gray-100 dark:border-gray-700 active:scale-95 transition-all"
             :style="{ transform: swipeItemId === day.id ? 'translateX(-80px)' : 'translateX(0)' }">
            
            <div class="flex-1 min-w-0">
                <div class="flex items-center space-x-2 mb-1">
                    <span class="font-bold text-gray-800 dark:text-white truncate">{{ day.name }}</span>
                    <span v-if="day.isLunar" class="text-[10px] bg-red-100 text-red-600 px-1.5 py-0.5 rounded font-bold">å†œ</span>
                </div>
                <div class="text-[10px] text-gray-400 font-medium">ç›®æ ‡æ—¥æœŸ: {{ day.date }} {{ getRepeatText(day.repeat) }}</div>
            </div>
            <div class="text-right pl-4 border-l border-gray-50 dark:border-gray-700 ml-2">
                <div class="text-2xl font-black text-blue-600 dark:text-blue-400 leading-none">
                    {{ getDaysUntilData(day).days }}
                </div>
                <div class="text-[9px] font-black text-gray-300 dark:text-gray-500 mt-1 tracking-tighter">DAYS</div>
            </div>
        </div>
    </div>
    </div>

        <div v-else class="py-20 text-center opacity-20">
            <div class="text-4xl mb-2">â³</div>
            <p class="text-sm">ç‚¹å‡»ä¸Šæ–¹ + å·æ·»åŠ é‡è¦æ—¥å­</p>
        </div>

        <div v-if="expiredList.length > 0" class="mt-4">
            <button @click="showExpiredCountdown = !showExpiredCountdown" 
                    class="w-full py-2 flex items-center justify-center space-x-2 text-gray-400 hover:text-blue-500 transition-colors">
                <div class="h-px flex-1 bg-gray-200 dark:bg-gray-800"></div>
                <span class="text-[10px] font-bold tracking-widest uppercase">
                    {{ showExpiredCountdown ? 'éšè—å·²è¿‡æœŸ' : 'æŸ¥çœ‹ ' + expiredList.length + ' ä¸ªå†å²æ—¶åˆ»' }}
                </span>
                <div class="h-px flex-1 bg-gray-200 dark:bg-gray-800"></div>
            </button>

            <div v-if="showExpiredCountdown" class="mt-3 space-y-2 opacity-60 grayscale">
                <div v-for="day in expiredList" :key="day.id" class="swipe-container mb-2">
                    
                    <div @click.stop="deleteCountdown(day.id)" class="delete-action">
                        åˆ é™¤
                    </div>

                    <div @touchstart="handleSwipeStart($event, day.id)"
                        @touchmove="handleSwipeMove($event, day.id)"
                        @touchend="handleSwipeEnd($event, day.id)"
                        @click="swipeItemId === day.id ? swipeItemId = null : openCountdownModal('edit', day)"
                        class="swipe-content bg-white dark:bg-gray-800 rounded-xl p-3 flex items-center border-l-4 border-gray-300 shadow-sm"
                        :style="{ transform: swipeItemId === day.id ? 'translateX(-80px)' : 'translateX(0)' }">
                        
                        <div class="flex-1 min-w-0">
                            <div class="text-sm font-bold text-gray-700 dark:text-gray-200 truncate">{{ day.name }}</div>
                            <div class="text-[9px] text-gray-400">{{ day.date }}</div>
                        </div>
                        
                        <div class="text-xs font-mono text-gray-400">
                            å·²è¿‡å» {{ Math.abs(getDaysUntilData(day).days) }} å¤©
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    </div>

    <div class="bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 flex justify-around items-center p-1 pb-safe z-30 text-[10px] select-none">
        <button @click="handleFocusTabClick" class="flex flex-col items-center p-2 w-1/4 rounded transition" :class="currentTab === 'now' ? 'text-blue-600 dark:text-blue-400 scale-105 font-bold' : 'text-gray-400'">
            <span class="text-xl mb-1">âš¡</span><span>ä¸“æ³¨</span>
        </button>
        <button @click="currentTab = 'quadrant'" class="flex flex-col items-center p-2 w-1/4 rounded transition" :class="currentTab === 'quadrant' ? 'text-blue-600 dark:text-blue-400 scale-105 font-bold' : 'text-gray-400'">
            <span class="text-xl mb-1">ğŸ“…</span><span>å››è±¡é™</span>
        </button>
        <button @click="currentTab = 'progress'" class="flex flex-col items-center p-2 w-1/4 rounded transition" :class="currentTab === 'progress' ? 'text-blue-600 dark:text-blue-400 scale-105 font-bold' : 'text-gray-400'">
            <span class="text-xl mb-1">ğŸ“Š</span><span>è¿›åº¦</span>
        </button>
        <button @click="currentTab = 'countdown'" class="flex flex-col items-center p-2 w-1/4 rounded transition" :class="currentTab === 'countdown' ? 'text-blue-600 dark:text-blue-400 scale-105 font-bold' : 'text-gray-400'">
            <span class="text-xl mb-1">â³</span><span>å€’æ•°æ—¥</span>
        </button>
    </div>

    <div v-if="editingTask" class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-fade-in px-4" @click.self="closeEditModal">
        <div class="bg-gray-100 dark:bg-gray-800 w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl animate-scale-up border dark:border-gray-700 transition-all">
            
            <div class="bg-white dark:bg-gray-800 px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <button @click="closeEditModal" class="text-blue-600 dark:text-blue-400 text-sm font-medium">å–æ¶ˆ</button>
                <span class="font-bold text-sm text-gray-800 dark:text-gray-100">ç¼–è¾‘ä»»åŠ¡</span>
                <button @click="saveEditTask" class="text-blue-600 dark:text-blue-400 text-sm font-bold">å®Œæˆ</button>
            </div>
            
            <div class="p-4 space-y-4">
                <div class="bg-white dark:bg-gray-700 rounded-xl overflow-hidden px-4 shadow-sm space-y-px">
                    
                    <div class="py-3 border-b border-gray-100 dark:border-gray-600" @click.stop>
                        <label class="block text-[10px] text-gray-400 mb-1">ä»»åŠ¡å†…å®¹</label>
                        <input v-model="editForm.text" type="text" autocomplete="off" @click.stop @touchstart.stop class="w-full bg-transparent outline-none text-base text-gray-800 dark:text-white placeholder-gray-400">
                    </div>
                    
                    <div class="py-3 border-b border-gray-100 dark:border-gray-600 flex items-center justify-between">
                        <span class="text-sm text-gray-800 dark:text-gray-300">é¢„ä¼°å·¥æ—¶ (å°æ—¶)</span>
                        <input v-model="editForm.duration" type="number" placeholder="0.5" step="0.1" class="bg-gray-100 dark:bg-gray-600 rounded-lg px-2 py-1 text-sm outline-none text-gray-600 dark:text-white border-none w-20 text-right">
                    </div>

                    <div class="py-3 border-b border-gray-100 dark:border-gray-600 flex items-center justify-between space-x-2">
                        <div class="flex-1">
                            <label class="block text-[10px] text-gray-400 mb-1">å¼€å§‹ (é€‰å¡«)</label>
                            <input v-model="editForm.startDate" type="date" class="w-full bg-gray-100 dark:bg-gray-600 rounded-lg px-2 py-1 text-xs outline-none text-gray-600 dark:text-white">
                        </div>
                        <span class="text-gray-300 pt-4">-</span>
                        <div class="flex-1 relative">
                            <label class="block text-[10px] text-gray-400 mb-1">ç»“æŸ (é€‰å¡«)</label>
                            <input v-model="editForm.endDate" type="date" 
                                :disabled="editForm.isLongTerm"
                                :class="{'opacity-50 cursor-not-allowed bg-gray-200 dark:bg-gray-700': editForm.isLongTerm}"
                                class="w-full bg-gray-100 dark:bg-gray-600 rounded-lg px-2 py-1 text-xs outline-none text-gray-600 dark:text-white transition-all">
                            
                            <div v-if="!editForm.isLongTerm && editForm.repeat !== 'none' && !editForm.endDate" 
                                class="absolute -bottom-3 left-0 text-[9px] text-orange-500 font-medium animate-pulse">
                                â†‘ è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ
                            </div>
                        </div>
                    </div>

                    <div class="py-3 flex justify-between items-center">
                        <span class="text-sm text-gray-800 dark:text-gray-300">é‡å¤</span>
                        <div class="flex items-center space-x-2">
    
                            <label v-if="editForm.repeatInterval > 1 && editForm.repeat !== 'none'" 
                                    class="flex items-center space-x-1 cursor-pointer bg-blue-50 dark:bg-blue-900/30 px-2 py-0.5 rounded border border-blue-200 dark:border-blue-800 animate-fade-in">
                                <input type="checkbox" v-model="editForm.isLongTerm" 
                                        @change="editForm.isLongTerm ? editForm.endDate = '' : null"
                                        class="accent-blue-600 w-3 h-3">
                                <span class="text-xs text-blue-600 dark:text-blue-400 font-bold">é•¿æœŸ</span>
                            </label>

                            <div v-if="editForm.repeat !== 'none'" class="flex items-center bg-gray-100 dark:bg-gray-600 rounded px-2 py-0.5 transition-all">
                                <span class="text-xs text-gray-500 dark:text-gray-400 mr-1">æ¯</span>
                                <input v-model="editForm.repeatInterval" 
                                    @input="editForm.repeatInterval < 2 ? editForm.isLongTerm = false : null"
                                    type="number" min="1" 
                                    class="w-8 bg-transparent text-center text-sm font-bold text-blue-600 dark:text-blue-400 outline-none border-none p-0">
                            </div>

                            <select v-model="editForm.repeat" class="bg-transparent text-gray-500 dark:text-gray-300 text-sm outline-none dir-rtl appearance-none text-right pr-4 cursor-pointer">
                                <option value="none">ä¸é‡å¤</option>
                                <option value="day">å¤©</option>
                                <option value="week">å‘¨</option>
                                <option value="month">æœˆ</option>
                                <option value="year">å¹´</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button @click="deleteCurrentTask" class="w-full py-3 bg-white dark:bg-gray-700 text-red-500 rounded-xl font-medium shadow-sm active:scale-95 transition">
                    åˆ é™¤ä»»åŠ¡
                </button>
            </div>
        </div>
    </div>

    <div v-if="showCountdownModal" class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-fade-in px-4" @click.self="closeCountdownModal">
        <div class="bg-gray-100 dark:bg-gray-800 w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl animate-scale-up border dark:border-gray-700 transition-all">
            <div class="bg-white dark:bg-gray-800 px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <button @click="closeCountdownModal" class="text-blue-600 dark:text-blue-400 text-sm font-medium">å–æ¶ˆ</button>
                <span class="font-bold text-sm text-gray-800 dark:text-gray-100">{{ countdownFormMode === 'add' ? 'æ–°å»ºå€’æ•°æ—¥' : 'ç¼–è¾‘å€’æ•°æ—¥' }}</span>
                <button @click="saveCountdown" class="text-blue-600 dark:text-blue-400 text-sm font-bold">ä¿å­˜</button>
            </div>
            
            <div class="p-4 space-y-4">
                <div class="bg-white dark:bg-gray-700 rounded-xl overflow-hidden px-4 shadow-sm" @click.stop>
                    <div class="py-3 border-b border-gray-100 dark:border-gray-600 flex items-center">
                        <input v-model="countdownForm.name" type="text" autocomplete="off" @click.stop @touchstart.stop placeholder="äº‹ä»¶åç§° (å¦‚: ç”Ÿæ—¥)" class="w-full bg-transparent outline-none text-base text-gray-800 dark:text-white placeholder-gray-400">
                    </div>
                    <div class="py-3 flex items-center justify-between">
                        <span class="text-sm text-gray-800 dark:text-gray-300">æ—¥æœŸ</span>
                        <input v-model="countdownForm.date" type="date" class="bg-gray-100 dark:bg-gray-600 rounded-lg px-2 py-1 text-sm outline-none text-gray-600 dark:text-white border-none">
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-700 rounded-xl overflow-hidden px-4 py-1 shadow-sm">
                    <div class="py-3 border-b border-gray-100 dark:border-gray-600 flex justify-between items-center">
                        <span class="text-sm text-gray-800 dark:text-gray-300">å†œå†æ¨¡å¼</span>
                        <label class="ios-switch">
                            <input type="checkbox" v-model="countdownForm.isLunar">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="py-3 flex justify-between items-center">
                        <span class="text-sm text-gray-800 dark:text-gray-300">é‡å¤</span>
                        <select v-model="countdownForm.repeat" class="bg-transparent text-gray-500 dark:text-gray-300 text-sm outline-none dir-rtl appearance-none text-right pr-4">
                            <option value="none">ä¸é‡å¤</option>
                            <option value="year">æ¯å¹´</option>
                            <option value="month">æ¯æœˆ</option>
                            <option value="week">æ¯å‘¨</option>
                            <option value="day">æ¯æ—¥</option>
                        </select>
                    </div>
                </div>
                
                <p class="text-[10px] text-center text-gray-400 px-2 leading-relaxed">
                    å¼€å¯â€œæ¯å¹´é‡å¤â€å°†è‡ªåŠ¨è®¡ç®—ä¸‹ä¸€ä¸ªçºªå¿µæ—¥ã€‚<br>
                    å¦‚æœæ˜¯å†œå†ç”Ÿæ—¥ï¼Œè¯·åœ¨ä¸Šæ–¹é€‰æ‹©è¯¥å†œå†å¯¹åº”çš„<span class="text-blue-500">å…¬å†æ—¥æœŸ</span>ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è½¬æ¢ã€‚
                </p>
                <div v-if="countdownFormMode === 'edit'" class="mt-4">
                    <button @click="deleteCountdown(countdownForm.id); closeCountdownModal();" 
                            class="w-full py-3 bg-white dark:bg-gray-700 text-red-500 rounded-xl font-bold shadow-sm active:scale-95 transition-all border border-red-50 dark:border-red-900/20">
                        åˆ é™¤æ­¤å€’æ•°æ—¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showQuadrantModal" class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-fade-in px-4" @click.self="closeQuadrantModal">
        <div class="bg-gray-100 dark:bg-gray-800 w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl animate-scale-up border dark:border-gray-700 transition-all">
            <div class="bg-white dark:bg-gray-800 px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <button @click="closeQuadrantModal" class="text-blue-600 dark:text-blue-400 text-sm font-medium">å–æ¶ˆ</button>
                <span class="font-bold text-sm text-gray-800 dark:text-gray-100">æ–°å»ºä»»åŠ¡</span>
                <button @click="saveQuadrantTask" class="text-blue-600 dark:text-blue-400 text-sm font-bold">ä¿å­˜</button>
            </div>
            
            <div class="p-4 space-y-3">
                <div class="text-center text-xs text-gray-400">
                    æ·»åŠ åˆ°: <span class="font-bold" :class="{'text-red-500': quadrantForm.q===1, 'text-blue-500': quadrantForm.q===2, 'text-yellow-500': quadrantForm.q===3}">{{ quadrantTitles[quadrantForm.q-1] }}</span>
                </div>

                <div class="bg-white dark:bg-gray-700 rounded-xl overflow-hidden px-4 shadow-sm space-y-px" @click.stop>
                    <div class="py-3 border-b border-gray-100 dark:border-gray-600 flex items-center">
                        <input v-model="quadrantForm.text" type="text" autocomplete="off" @click.stop @touchstart.stop placeholder="å‡†å¤‡åšä»€ä¹ˆï¼Ÿ" class="w-full bg-transparent outline-none text-base text-gray-800 dark:text-white placeholder-gray-400">
                    </div>
                    
                    <div class="py-3 border-b border-gray-100 dark:border-gray-600 flex items-center justify-between">
                        <span class="text-sm text-gray-800 dark:text-gray-300">é¢„ä¼°å·¥æ—¶ (å°æ—¶)</span>
                        <input v-model="quadrantForm.duration" type="number" placeholder="0.5" step="0.1" class="bg-gray-100 dark:bg-gray-600 rounded-lg px-2 py-1 text-sm outline-none text-gray-600 dark:text-white border-none w-20 text-right">
                    </div>

                    <div class="py-3 border-b border-gray-100 dark:border-gray-600 flex items-center justify-between space-x-2">
                        <div class="flex-1">
                            <label class="block text-[10px] text-gray-400 mb-1">å¼€å§‹æ—¥æœŸ</label>
                            <input v-model="quadrantForm.startDate" type="date" class="w-full bg-gray-100 dark:bg-gray-600 rounded-lg px-2 py-1 text-xs outline-none text-gray-600 dark:text-white">
                        </div>
                        <span class="text-gray-300 pt-4">-</span>
                        <div class="flex-1 relative"> <label class="block text-[10px] text-gray-400 mb-1">ç»“æŸæ—¥æœŸ</label>
                            <input v-model="quadrantForm.endDate" type="date" 
                                :disabled="quadrantForm.isLongTerm"
                                :class="{'opacity-50 cursor-not-allowed bg-gray-200 dark:bg-gray-700': quadrantForm.isLongTerm}"
                                class="w-full bg-gray-100 dark:bg-gray-600 rounded-lg px-2 py-1 text-xs outline-none text-gray-600 dark:text-white transition-all">
                            
                            <div v-if="!quadrantForm.isLongTerm && quadrantForm.repeat !== 'none' && !quadrantForm.endDate" 
                                class="absolute -bottom-3 left-0 text-[9px] text-orange-500 font-medium animate-pulse">
                                â†‘ è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ
                            </div>
                        </div>
                    </div>

                    <div class="py-3 flex justify-between items-center">
                        <span class="text-sm text-gray-800 dark:text-gray-300">é‡å¤</span>
                        <div class="flex items-center space-x-2">
                            
                            <label v-if="quadrantForm.repeatInterval > 1 && quadrantForm.repeat !== 'none'" 
                                    class="flex items-center space-x-1 cursor-pointer bg-blue-50 dark:bg-blue-900/30 px-2 py-0.5 rounded border border-blue-200 dark:border-blue-800 animate-fade-in">
                                <input type="checkbox" v-model="quadrantForm.isLongTerm" 
                                        @change="quadrantForm.isLongTerm ? quadrantForm.endDate = '' : null"
                                        class="accent-blue-600 w-3 h-3">
                                <span class="text-xs text-blue-600 dark:text-blue-400 font-bold">é•¿æœŸ</span>
                            </label>
                            
                            <div v-if="quadrantForm.repeat !== 'none'" class="flex items-center bg-gray-100 dark:bg-gray-600 rounded px-2 py-0.5 transition-all">
                                <span class="text-xs text-gray-500 dark:text-gray-400 mr-1">æ¯</span>
                                <input v-model="quadrantForm.repeatInterval" 
                                        @input="quadrantForm.repeatInterval < 2 ? quadrantForm.isLongTerm = false : null"
                                        type="number" min="1" 
                                        class="w-8 bg-transparent text-center text-sm font-bold text-blue-600 dark:text-blue-400 outline-none border-none p-0">
                            </div>

                            <select v-model="quadrantForm.repeat" class="bg-transparent text-gray-500 dark:text-gray-300 text-sm outline-none dir-rtl appearance-none text-right pr-4 cursor-pointer">
                                <option value="none">ä¸é‡å¤</option>
                                <option value="day">å¤©</option>
                                <option value="week">å‘¨</option>
                                <option value="month">æœˆ</option>
                                <option value="year">å¹´</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showSyncModal" class="absolute inset-0 z-50 flex items-center justify-center bg-black/50 animate-fade-in" @click.self="showSyncModal = false">
        <div class="bg-white dark:bg-gray-800 w-11/12 max-w-md rounded-2xl p-6 shadow-2xl animate-scale-up">
            <h3 class="text-lg font-bold mb-2 flex items-center text-gray-800 dark:text-white">
                <span class="mr-2">â˜ï¸</span> GitHub äº‘åŒæ­¥
            </h3>
            <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">ä½¿ç”¨ GitHub Gist å®ç°å¤šè®¾å¤‡å…è´¹æ•°æ®åŒæ­¥ã€‚</p>
            
            <div class="space-y-3">
                <div>
                    <label class="text-xs font-bold text-gray-600 dark:text-gray-400 block mb-1">GitHub Token (å¿…å¡«)</label>
                    <input v-model="githubToken" type="password" placeholder="ç²˜è´´ ghp_ å¼€å¤´çš„ Token" class="w-full p-2 border border-gray-200 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-700 dark:text-white focus:border-blue-500 outline-none transition">
                </div>
                
                <div>
                    <label class="text-xs font-bold text-gray-600 dark:text-gray-400 block mb-1">Gist ID (é€‰å¡«, åˆæ¬¡ç•™ç©º)</label>
                    <input v-model="gistId" type="text" placeholder="åˆæ¬¡ä½¿ç”¨ä¼šè‡ªåŠ¨ç”Ÿæˆ" class="w-full p-2 border border-gray-200 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-700 dark:text-white focus:border-blue-500 outline-none transition">
                </div>
                
                <div class="flex space-x-2 pt-2">
                    <button @click="handleSync('upload')" class="flex-1 bg-blue-600 text-white py-2 rounded-lg text-sm font-bold shadow-md hover:bg-blue-700 active:scale-95 transition">
                        â†‘ ä¸Šä¼ æœ¬åœ°æ•°æ®
                    </button>
                    <button @click="handleSync('download')" class="flex-1 bg-gray-100 dark:bg-gray-700 text-blue-600 dark:text-blue-400 py-2 rounded-lg text-sm font-bold border border-blue-100 dark:border-gray-600 hover:bg-blue-50 active:scale-95 transition">
                        â†“ ä¸‹è½½äº‘ç«¯æ•°æ®
                    </button>
                </div>
            </div>

            <div class="mt-4 text-[10px] text-gray-400 border-t dark:border-gray-700 pt-2">
                <p>1. å» github.com/settings/tokens ç”Ÿæˆ Token (å‹¾é€‰ gist æƒé™)</p>
                <p>2. ç²˜è´´ Tokenï¼Œç‚¹å‡»â€œä¸Šä¼ â€ï¼ŒGist ID ä¼šè‡ªåŠ¨å¡«å…¥</p>
                <p>3. åœ¨å…¶ä»–æ‰‹æœºå¡«å…¥ Token å’Œ IDï¼Œç‚¹å‡»â€œä¸‹è½½â€å³å¯åŒæ­¥</p>
            </div>
            
            <button @click="showSyncModal = false" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500">Ã—</button>
        </div>
    </div>
    <!-- æ¥å…¥ai -->
    <div v-if="showAiConfigModal" 
        @click.self="showAiConfigModal = false" 
        class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-6">
        
        <div class="bg-white dark:bg-gray-800 w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-scale-up border dark:border-gray-700 relative text-left">
            
            <button @click="showAiConfigModal = false" 
                    class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
                <span class="text-xl">Ã—</span>
            </button>

            <h3 class="text-lg font-bold mb-2 flex items-center text-gray-800 dark:text-white">
                <span class="mr-2">ğŸ¤–</span> æ™ºè„‘å®éªŒå®¤é…ç½®
            </h3>

            <div class="space-y-4 mt-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">é€‰æ‹©æ¨¡å‹</label>
                    <select v-model="aiConfig.model" class="w-full bg-gray-50 dark:bg-gray-900 p-3 rounded-xl text-sm outline-none border border-transparent focus:border-indigo-500">
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash (æé€Ÿ/å…è´¹)</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro (å…¨èƒ½/æ·±åº¦)</option>
                    </select>
                </div>
                
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">API Key</label>
                    <input v-model="aiConfig.key" type="password" placeholder="ç²˜è´´ä½ çš„ API Key" 
                        class="w-full p-3 bg-gray-50 dark:bg-gray-900 rounded-xl text-sm outline-none border border-transparent focus:border-indigo-500">
                </div>
            </div>

            <button @click="saveAiConfig" class="w-full bg-indigo-600 text-white py-3 rounded-2xl font-bold mt-6 active:scale-95 transition">
                æ¥é€šç”µåŠ›
            </button>
        </div>
    </div>

    <div v-if="showAddIdentityModal" 
         @click.self="showAddIdentityModal = false"
         class="fixed inset-0 z-[110] flex items-center justify-center bg-black/50 backdrop-blur-sm p-6">
        <div class="bg-white dark:bg-gray-800 w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-scale-up relative">
            <h3 class="text-lg font-bold mb-2 text-gray-800 dark:text-white">âœ¨ å®šä¹‰ä½ çš„è¿›åŒ–èº«ä»½</h3>
            <p class="text-xs text-gray-400 mb-4 tracking-tight">ä½ æƒ³é€šè¿‡ Future Flow æˆä¸ºä¸€ä¸ªæ€æ ·çš„äººï¼Ÿ</p>
            
            <input v-model="newIdentityInput" 
                   type="text" 
                   placeholder="ä¾‹å¦‚ï¼šæµåˆ©çš„è‹±è¯­å£è¯­äº¤æµè€…" 
                   class="w-full p-4 bg-gray-50 dark:bg-gray-900 rounded-2xl text-sm outline-none border-2 border-transparent focus:border-indigo-500 mb-6">
            
            <button @click="confirmAddIdentity" 
                    class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-transform">
                ç¡®è®¤ å¼€å¯è¿›åŒ–
            </button>
        </div>
    </div>

    <div v-if="showEditIdentityModal" 
        @click.self="showEditIdentityModal = false"
        class="fixed inset-0 z-[120] flex items-center justify-center bg-black/50 backdrop-blur-sm p-6">
        <div class="bg-white dark:bg-gray-800 w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-scale-up relative">
            <h3 class="text-lg font-bold mb-2 text-gray-800 dark:text-white">âš™ï¸ ç®¡ç†è¿›åŒ–èº«ä»½</h3>
            
            <input v-model="editIdentityInput" type="text" 
                class="w-full p-4 bg-gray-50 dark:bg-gray-900 rounded-2xl text-sm outline-none border-2 border-transparent focus:border-indigo-500 my-4">
            
            <div class="space-y-2">
                <button @click="confirmEditIdentity" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black active:scale-95 transition-transform">
                    ä¿å­˜ä¿®æ”¹
                </button>
                <button @click="deleteIdentity" class="w-full py-3 text-red-500 text-xs font-bold">
                    åˆ é™¤æ­¤èº«ä»½
                </button>
            </div>
        </div>
    </div>

    <div v-if="showProgressModal" class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-fade-in px-4" @click.self="showProgressModal = false">
        <div class="bg-white dark:bg-gray-800 w-full max-w-[16rem] rounded-2xl overflow-hidden shadow-2xl animate-scale-up border dark:border-gray-700 transition-all">
            
            <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800">
                <span class="font-bold text-sm text-gray-800 dark:text-gray-100">è°ƒæ•´å·¥æ—¶</span>
                <button @click="showProgressModal = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">Ã—</button>
            </div>
            
            <div class="p-5 text-center">
                <div class="mb-4">
                <div class="text-xs text-gray-500 dark:text-gray-400 truncate px-2 mb-1">
                    ä»»åŠ¡: <span class="font-bold text-gray-700 dark:text-gray-300">{{ progressForm.taskText }}</span>
                </div>
                <div class="text-[10px] text-gray-400 bg-gray-100 dark:bg-gray-700/50 py-1 rounded-lg inline-block px-3">
                    å½“å‰ç´¯è®¡: <span class="font-mono font-bold text-blue-500">{{ (tasks.find(t=>t.id===progressForm.taskId)?.accumulated || 0).toFixed(1) }}h</span>
                </div>
            </div>

            
                
                <div class="flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-xl px-4 py-3 mx-4 mb-4 border border-transparent focus-within:border-blue-500 focus-within:bg-white dark:focus-within:bg-gray-800 transition-all">
                    <input ref="progressInputRef" 
                           v-model="progressForm.hours" 
                           type="number" 
                           step="1" 
                           placeholder="æ–°å¢åˆ†é’Ÿ" 
                           class="w-24 bg-transparent text-2xl font-bold text-blue-600 dark:text-blue-400 outline-none text-center placeholder-gray-300 dark:placeholder-gray-600"
                           @keyup.enter="saveTaskProgress">
                    <span class="text-sm text-gray-400 font-bold ml-1 pt-1">min</span>
                </div>

                <button @click="saveTaskProgress" class="w-full bg-blue-600 text-white py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/30 active:scale-95 transition-transform">
                    ç¡®è®¤
                </button>
            </div>
        </div>
    </div>
</div>
<script type="module" src="js/app.js"></script>
</body>
</html>
